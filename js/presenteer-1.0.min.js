/**
* Presenteer class
* @author Willem Mulder
*
* Note: don't use element-rotates of 90 or 270 degrees in combination with element-translates. 
* A bug in the Sylvester matrix libs will set the horizontal translation to 0 when you do this
*/
(function(){function calculatePosition(e,t){return{left:e.offset().left-t.offset().left,top:e.offset().top-t.offset().top}}function disableAllTransitions(){$("body").append("<div id='presenteerjs-notransition'><style>*{ -webkit-transition: none !important; -moz-transition: none !important; -o-transition: none !important; -ms-transition: none !important; transition: none !important; }</style></div>")}function undoDisableAllTransitions(){$("#presenteerjs-notransition").remove()}function disableAllTransformations(){$("body").append("<div id='presenteerjs-notransformation'><style>*{ -webkit-transform: none !important; -moz-transform: none !important; -o-transform: none !important; -ms-transform: none !important; transform: none !important;}</style></div>")}function undoDisableAllTransformations(){$("#presenteerjs-notransformation").remove()}function getTransitions(e){var t={};var n=$(e);for(var r in prefixes){var i=prefixes[r];var s=t[r]={};s["transition-delay"]=n.css(i+"TransitionDelay");s["transition-duration"]=n.css(i+"TransitionDuration");s["transition-property"]=n.css(i+"TransitionProperty");s["transition-timing-function"]=n.css(i+"TransitionTimingFunction")}return t}function getStyle(e){var t=document.defaultView.getComputedStyle($(e).get(0),"");var n=function(e,t){return t.toUpperCase()};var r=[];for(var i=0;i<t.length;i++){var s=t[i];var o=s.replace(/\-([a-z])/g,n);var u=t.getPropertyValue(s);r[o]=u}return r}function setTransitions(e,t){var n=$(e);for(var r in prefixes){var i=prefixes[r];var s=t[r]||{};n.css(i+"TransitionDelay",s["transition-delay"]||t["transition-delay"]||"0s");n.css(i+"TransitionDuration",s["transition-duration"]||t["transition-duration"]||"0s");n.css(i+"TransitionProperty",s["transition-property"]||t["transition-property"]||"none");n.css(i+"TransitionTimingFunction",s["transition-timing-function"]||t["transition-timing-function"]||"")}}function getTransitionString(e){for(var t in e){var n=e[t];var r=false;if(n["transition-duration"]!=""&&n["transition-duration"]!="0"&&n["transition-duration"]!="0s"&&n["transition-duration"]!=null){return n["transition-property"]+" "+n["transition-duration"]+" "+n["transition-timing-function"]}}return""}function setTransformOrigin(e,t,n){for(var r in prefixes){var i=prefixes[r];$(e).css(i?i+"TransformOrigin":"transformOrigin",t+" "+n)}}function getTransformOrigin(e){var t=$(e).get(0).style.WebkitTransformOrigin||$(e).get(0).style.MozTransformOrigin||$(e).get(0).style.OTransformOrigin||$(e).get(0).style.msTransformOrigin||$(e).get(0).style.transformOrigin||"";var n=t.match(/^([^ ]+) ([^ ]+)$/);if(n){return{x:n[1],y:n[2]}}else{return{x:0,y:0}}}function getTransformation(e){return $(e).get(0).style.WebkitTransform||$(e).get(0).style.MozTransform||$(e).get(0).style.OTransform||$(e).get(0).style.msTransform||$(e).get(0).style.transform||""}function setTransformation(e,t){for(var n in prefixes){var r=prefixes[n];$(e).css(r?r+"Transform":"transform",t)}}function addTransformation(e,t){var n=$(e).get(0).style;if(n.MozTransform){n.MozTransform+=t}if(n.WebkitTransform){n.WebkitTransform+=t}if(n.OTransform){n.OTransform+=t}if(n.msTransform){n.msTransform+=t}if(n.transform){n.transform+=t}}function logTransformations(e){var t=$(e).get(0).style;console.log(t.MozTransform);console.log(t.WebkitTransform);console.log(t.OTransform);console.log(t.msTransform);console.log(t.transform)}function hasTransformation(e,t){var n=$(e).get(0).style;return n.MozTransform&&n.MozTransform.indexOf(t)!==-1||n.WebkitTransform&&n.WebkitTransform.indexOf(t)!==-1||n.OTransform&&n.OTransform.indexOf(t)!==-1||n.msTransform&&n.msTransform.indexOf(t)!==-1||n.transform&&n.transform.indexOf(t)!==-1}function removeTransformation(e,t){if(!t){return setTransformation(e,"")}var n=$(e).get(0).style;for(i in prefixes){var r=prefixes[i];if(n[r?r+"Transform":"transform"]){var s=n[r?r+"Transform":"transform"].toLowerCase().replace(t.toLowerCase()," ");$(e).css(r?r+"Transform":"transform",s)}}}function processElementTransforms(e){return getInverseMatrixString(e)}function getInverseMatrixString(elm){var matrix="";for(var prefixID in prefixes){var prefix=prefixes[prefixID];if($(elm).css(prefix+"Transform")!=null&&$(elm).css(prefix+"Transform").indexOf("matrix")===0){var matrix=$(elm).css(prefix?prefix+"Transform":"transform");break}}if(matrix!=""){var sylvesterMatrixString=matrix.replace(/matrix\((.+)\, (.+)\, (.+)\, (.+)\, (.+?)p?x?\, (.+?)p?x?\)/,"$M([[$1,$3,$5],[$2,$4,$6],[0,0,1]])");var sylvesterMatrix=eval(sylvesterMatrixString);var inverseMatrix=sylvesterMatrix.inverse();var inverseMatrixString="";if(inverseMatrix!=null){inverseMatrixString="matrix("+Math.round(inverseMatrix.e(1,1)*1e8)/1e8+", "+Math.round(inverseMatrix.e(2,1)*1e8)/1e8+", "+Math.round(inverseMatrix.e(1,2)*1e8)/1e8+", "+Math.round(inverseMatrix.e(2,2)*1e8)/1e8+", "+Math.round(inverseMatrix.e(1,3)*1e8)/1e8+", "+Math.round(inverseMatrix.e(2,3)*1e8)/1e8+""+")"}return inverseMatrixString}return""}function outerScrollHeight(e,t){if($.browser.mozilla||$.browser.opera){var n=$(e).get(0).scrollHeight;var r=$(e).get(0).style.overflow;$(e).get(0).style.overflow="scroll"}var i=$(e).get(0).scrollHeight;if($.browser.mozilla||$.browser.opera){if(n>i){i=n}$(e).get(0).style.overflow=r}i=i+($(e).outerHeight(t)-$(e).innerHeight());return i}function outerScrollWidth(e,t){if($.browser.mozilla||$.browser.opera){var n=$(e).get(0).scrollWidth;var r=$(e).get(0).style.overflow;$(e).get(0).style.overflow="scroll"}var i=$(e).get(0).scrollWidth;if($.browser.mozilla||$.browser.opera){if(n>i){i=n}$(e).get(0).style.overflow=r}i+=$(e).outerWidth(t)-$(e).innerWidth();return i}function toggleFullScreen(e){if(isFullScreen===false){if(typeof e=="undefined"){var e=$(canvas).parent().get(0)}fullScreen()}else{cancelFullScreen()}}function fullScreen(e){if(typeof e=="undefined"){fullScreenElement=$(canvas).parent().get(0)}else{fullScreenElement=$(e).get(0)}if(fullScreenSupport){if(fullScreenElement.requestFullScreen){fullScreenElement.requestFullScreen()}else if(fullScreenElement.mozRequestFullScreen){fullScreenElement.mozRequestFullScreen();fullScreenElement.mozfullscreenerror=function(){isFullScreen=false;return}}else if(fullScreenElement.webkitRequestFullScreen){fullScreenElement.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)}else if(fullScreenElement.oRequestFullScreen){fullScreenElement.oRequestFullScreen()}}else{$("body").append("<div id='presenteerjsfullscreenbackground' style='position: fixed; background: #000; left: 0px; top: 0px; right: 0px; bottom: 0px;'></div>");fullScreenBackupStyling=$(fullScreenElement).attr("style");$(fullScreenElement).attr("style",fullScreenBackupStyling+"; position: fixed; z-index: 1000; left: 0px; top: 0px; right: 0px; bottom: 0px;")}isFullScreen=true}function cancelFullScreen(){if(fullScreenSupport){if(document.cancelFullScreen){document.cancelFullScreen()}else if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else if(document.webkitCancelFullScreen){document.webkitCancelFullScreen()}else if(document.oCancelFullScreen){document.oCancelFullScreen()}}else{$("#presenteerjsfullscreenbackground").remove();$(fullScreenElement).attr("style",fullScreenBackupStyling||"")}isFullScreen=false}window.Presenteer=function(e,t,n){function d(){disableAllTransitions();disableAllTransformations();for(i in elements){var t=elements[i].element;var n=calculatePosition(t,e);h[i]=n;$(t).data("cachedPosition",n)}undoDisableAllTransformations();undoDisableAllTransitions()}function v(e){if(typeof e=="string"){e=$(e)}var t=[];$.each(e,function(e,n){if(n.nodeType==1){t.push({element:$(n)})}else if(typeof n=="string"){t.push({element:$(n)})}else{t.push(n)}});return t}function m(t){var i=$(t.element);if(!n.cachePositions){var s=getTransitions(e);setTransitions(e,{});var o=getTransitions(i);setTransitions(i,{});var u=getTransformation(e);setTransformation(e,"none");var a=getTransformation(i);setTransformation(i,"none");var f=calculatePosition(i,e)}else{var f=i.data("cachedPosition")}var l=f.left;var c=f.top;var h=e.outerWidth(n.showOriginalMargins);var p=e.outerHeight(n.showOriginalMargins);var d=e.parent().outerWidth();var v=e.parent().outerHeight();var m=i.outerWidth(n.showOriginalMargins)/d;var g=i.outerHeight(n.showOriginalMargins)/v;var y=Math.max(m,g);r=1/y;var b=(l-i.outerWidth(n.showOriginalMargins)*(r-1)/2)*-1;var w=(c-i.outerHeight(n.showOriginalMargins)*(r-1)/2)*-1;if(m>g){if(n.centerVertically){var E=v-i.outerHeight(n.showOriginalMargins)*r;w+=E/2}}else{if(n.centerHorizontally){var E=d-i.outerWidth(n.showOriginalMargins)*r;b+=E/2}}if(n.centerVertically&&outerScrollHeight(e,n.showOriginalMargins)*r<v){if(!$.browser.webkit&&!$.browser.opera){w=(v-outerScrollHeight(e,n.showOriginalMargins)*r)/2}}if(n.centerHorizontally&&outerScrollWidth(e,n.showOriginalMargins)*r<d){if(!$.browser.webkit&&!$.browser.opera){}}var S=Math.round((l*1+i.outerWidth()/2)*1e4)/1e4+"px";var x=Math.round((c*1+i.outerHeight()/2)*1e4)/1e4+"px";if(!n.cachePositions){setTransformation(e,u);setTransformation(i,a)}setTimeout(function(){var t=getTransitionString(s);if(t!=""&&n.useExistingTransitionIfAvailable){setTransitions(e,s)}else{setTransitions(e,n.transition)}if(!n.cachePositions){setTransitions(i,o)}var u=n.followElementTransforms?processElementTransforms(i):"";var a=" translate("+Math.round(b*1e4)/1e4+"px,"+Math.round(w*1e4)/1e4+"px)  scale("+Math.round(r*1e4)/1e4+") "+u;setTransformOrigin(e,S,x);setTransformation(e,a)},50)}var e=$(e);if(e.size()==0){return false}setTransformOrigin(e,0,0);var r=1;elements=v(t);var s=-1;var o=-1;var u=document.documentElement.requestFullScreen||document.documentElement.mozRequestFullScreen||document.documentElement.webkitRequestFullScreen||document.documentElement.oRequestFullScreen;var a=false;var f=function(){setTimeout(function(){m(elements[s])},10)};document.addEventListener("mozfullscreenchange",function(){if(typeof mozFullScreenElement=="undefined"){a=false}f()});document.addEventListener("webkitfullscreenchange",function(){if(typeof webkitFullScreenElement=="undefined"){a=false}f()});document.addEventListener("ofullscreenchange",function(){if(typeof oFullScreenElement=="undefined"){a=false}f()});$(document).on("keyup",function(e){if(e.which=="27"){cancelFullScreen();f()}});var l;var c;var h={};var p={cachePositions:true,showOriginalMargins:false,centerHorizontally:true,centerVertically:true,followElementTransforms:true,transition:{"transition-delay":"0s","transition-duration":"0.5s","transition-property":"all","transition-timing-function":"ease"},useExistingTransitionIfAvailable:true,onBeforeEnter:function(e){},onAfterEnter:function(e){},onBeforeLeave:function(e){},onAfterLeave:function(e){}};if(typeof n!="object"){n={}}for(index in p){if(typeof n[index]=="undefined"){n[index]=p[index]}}if(n.cachePositions){d()}return{start:function(){s=0;this.showCurrent()},restart:function(){o=s;s=0;this.showCurrent()},show:function(e){if(elements[e]){o=s;s=e}else{var t;for(var n in elements){var r=elements[n].element;if($(r).is(e)||$(r).data("presenteerid")==e){o=s;s=n;t=undefined;break}else if($(r).attr("id")==e){t=n}}if(typeof t!="undefined"){o=s;s=t}}this.showCurrent()},next:function(){o=s;s++;if(s>elements.length-1){s=0}this.showCurrent()},prev:function(){o=s;s--;if(s<0){s=elements.length-1}this.showCurrent()},previous:function(){this.prev()},showCurrent:function(){if(o<s){if(elements[o]&&typeof elements[o].onBeforeLeaveToNext=="function"){elements[o].onBeforeLeaveToNext()}if(typeof elements[s].onBeforeEnterFromPrev=="function"){elements[s].onBeforeEnterFromPrev()}}if(o>s){if(elements[o]&&typeof elements[o].onBeforeLeaveToPrev=="function"){elements[o].onBeforeLeaveToPrev()}if(typeof elements[s].onBeforeEnterFromNext=="function"){elements[s].onBeforeEnterFromNext()}}if(elements[o]&&typeof elements[o].onBeforeLeave=="function"){elements[o].onBeforeLeave()}if(typeof elements[s].onBeforeEnter=="function"){elements[s].onBeforeEnter()}if(elements[o]){n.onBeforeLeave(elements[o])}n.onBeforeEnter(elements[s]);m(elements[s]);if(o<s){if(elements[o]&&typeof elements[o].onAfterLeaveToNext=="function"){elements[o].onAfterLeaveToNext()}if(typeof elements[s].onAfterEnterFromPrev=="function"){elements[s].onAfterEnterFromPrev()}}if(o>s){if(typeof elements[o].onAfterLeaveToPrev=="function"){elements[o].onAfterLeaveToPrev()}if(typeof elements[s].onAfterEnterFromNext=="function"){elements[s].onAfterEnterFromNext()}}if(elements[o]&&typeof elements[o].onAfterLeave=="function"){elements[o].onAfterLeave()}if(typeof elements[s].onAfterEnter=="function"){elements[s].onAfterEnter()}if(elements[o]){n.onAfterLeave(elements[o])}n.onAfterEnter(elements[s])},getCanvas:function(){return $(e)},getCurrentIndex:function(){return s*1},getPrevIndex:function(){return o*1},getTotal:function(){return elements.length},toggleFullScreen:function(e){toggleFullScreen(e);m(elements[s])},fullScreen:function(e){fullScreen(e);m(elements[s])},cancelFullScreen:function(){cancelFullScreen();m(elements[s])},isFullScreen:function(){return a},update:function(){elements=v(t);if(n.cachePositions){d()}},getPositionAtCanvas:function(t){if(t.positionInViewport){var n=getInverseMatrixString(e);var r=$("<div style='width:1px;height:1px;position:absolute; background: #0000ff;"+"left:"+t.positionInViewport.x+"px; "+"top:"+t.positionInViewport.y+"px; "+"'>");var i=getTransformOrigin(e);setTransformOrigin(r,i.x,i.y);setTransformation(r,n);e.append(r);var s={x:r.position().left,y:r.position().top};r.remove();return s}}}};$.fn.scaleToFit=$.fn.scaleToFit||function(e){$(this).each(function(t,n){var r=e.parent?$(e.parent):$(n).parent();var i=$(n).outerWidth(false);var s=r.width();var o=s/i;var u=$(n).outerHeight(false);var a=r.height();var f=a/u;if(e&&e.zoomFromCenter){setTransformOrigin(n,i/2,u/2)}else{setTransformOrigin(n,0,0)}setTransformation(n,"scale("+Math.min(f,o)+")")})};$.fn.flipsideContent=$.fn.flipsideContent||function(e){$next=$(this).next(".presenteerjs-flipback");if($next.length==0){$elm=$('<div class="presenteerjs-flipback"></div>');var t=getStyle(this);t["background"]="#fff";$elm.css(t);addTransformation($elm," rotateY(180deg)");$(this).after($elm)}$(this).next(".presenteerjs-flipback").html(e);return this};$.fn.flip=$.fn.flip||function(e,t){var n=new $.Deferred;if($("#presenteerjs-flipped").size()==0){$("body").append("<div id='presenteerjs-flipped'><style>"+".presenteerjs-flipped-transition { -webkit-transition: all 0.4s linear !important; -moz-transition: all 0.4s ease !important; -o-transition: all 0.4s ease !important; -ms-transition: all 0.4s ease !important; transition: all 0.4s ease !important; }</style></div>")}$(this).each(function(r,i){if(!e&&$(i).next(".presenteerjs-flipback").length==0){disableAllTransitions();disableAllTransformations();$(this).flipsideContent("");undoDisableAllTransformations();setTimeout(function(){undoDisableAllTransitions();$(i).addClass("presenteerjs-flipped-transition");$(i).next(".presenteerjs-flipback").addClass("presenteerjs-flipped-transition");if(t||hasTransformation(i,"rotateY(180deg)")){removeTransformation(i,"rotateY(180deg)");addTransformation($(i).next()," rotateY(180deg)")}else{addTransformation(i," rotateY(180deg)");removeTransformation($(i).next(".presenteerjs-flipback"),"rotateY(180deg)");$(i).next(".presenteerjs-flipback").css("webkitBackfaceVisibility","hidden");$(i).next(".presenteerjs-flipback").css("-moz-backface-visibility","hidden");$(i).next(".presenteerjs-flipback").css("backface-visibility","hidden")}setTimeout(function(){$(i).removeClass("presenteerjs-flipped-transition");$(i).next(".presenteerjs-flipback").removeClass("presenteerjs-flipped-transition");n.resolve()},500)},1)}else{setTimeout(function(){$(i).addClass("presenteerjs-flipped-transition");$(i).next(".presenteerjs-flipback").addClass("presenteerjs-flipped-transition");if(t||hasTransformation(i,"rotateY(180deg)")){removeTransformation(i,"rotateY(180deg)");addTransformation($(i).next()," rotateY(180deg)")}else{addTransformation(i," rotateY(180deg)");removeTransformation($(i).next(".presenteerjs-flipback"),"rotateY(180deg)");$(i).next(".presenteerjs-flipback").css("webkitBackfaceVisibility",e?"visible":"hidden");$(i).next(".presenteerjs-flipback").css("-moz-backface-visibility",e?"visible":"hidden");$(i).next(".presenteerjs-flipback").css("backface-visibility",e?"visible":"hidden")}setTimeout(function(){$(i).removeClass("presenteerjs-flipped-transition");$(i).next(".presenteerjs-flipback").removeClass("presenteerjs-flipped-transition");n.resolve()},500)},10)}});return n.promise()};$.fn.presenteer=$.fn.presenteer||function(e,t){return new Presenteer($(this).first(),e,t)};var prefixes={moz:"Moz",webkit:"Webkit",o:"O",ms:"ms",all:""}})()
